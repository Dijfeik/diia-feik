<script>
    async function loadData() {
        const code = document.getElementById('code').value.trim();
        if (!code) {
            alert("Введіть код!");
            return;
        }
        try {
            console.log("Запит к API с кодом:", code);
            const res = await fetch(`https://192837465Ns.pythonanywhere.com/get_data?code=${code}`);
            if (!res.ok) {
                throw new Error(`HTTP ошибка: ${res.status}`);
            }
            const data = await res.json();
            console.log("Ответ от API:", data);
            let html = '';
            if (data.fio && data.fio.includes("ЗАВЕРШЕНО")) {
                html = `<p style="color:red;font-size:24px;">${data.fio}</p>`;
            } else {
                html = `<h2>Ваші дані</h2>
                        <p><strong>ПІБ:</strong> ${data.fio || ''}</p>
                        <p><strong>Дата народження:</strong> ${data.birthdate || ''}</p>
                        ${data.photo_url ? `<img src="https://192837465Ns.pythonanywhere.com${data.photo_url}" alt="Фото" style="max-width:200px;border-radius:12px;margin:20px 0;">` : ''}`;
            }
            document.getElementById('result').innerHTML = html;
        } catch (e) {
            console.error("Ошибка:", e);
            alert("Невірний код або помилка з'єднання");
        }
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
    }
</script>
